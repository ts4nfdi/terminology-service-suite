"use client";var G=Object.defineProperty;var J=(a,e,r)=>e in a?G(a,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[e]=r;var k=(a,e,r)=>J(a,typeof e!="symbol"?e+"":e,r);import{r as N,b as o}from"./iframe-YnD9Auhi.js";import{b1 as W,b2 as O,b0 as v,b3 as R,b4 as B,aR as D,af as S,b5 as H,b6 as X,u as Y}from"./widgetDescriptions-D-baph22.js";import{u as z}from"./useQuery-CCQGsteZ.js";/* empty css                  */import{E as Q}from"./ExpandableOntologyBadgeList-6fmAg6jV.js";import{E as V}from"./panel-B3lBZLDB.js";import{E as Z}from"./text-C7w47Js1.js";import{E as q}from"./loading_spinner-BVNnrKN2.js";import{E as _}from"./icon-B0KE5QCF.js";class L{static fromTopConcept(e){return{iri:e.uri,label:e.label,hasChildren:e.hasChildren,parents:[]}}static fromHierarchyResult(e){return{iri:e.uri,label:e.prefLabel,hasChildren:e.narrower!=null&&e.narrower.length>0,parents:v.fromJson(e.broader)}}static fromPrefAndUriAndChildren(e,r){return{iri:e.uri,label:e.prefLabel,hasChildren:e.hasChildren,parents:v.fromJson(r)}}static fromLabelAndUriAndChildren(e,r){return{iri:e.uri,label:e.label,hasChildren:e.hasChildren,parents:v.fromJson(r)}}}class j{constructor(e){k(this,"axiosInstance");this.axiosInstance=W.create({baseURL:e,headers:{Accept:"application/json"}})}async makeCall(e,r){return(await this.axiosInstance.get(e,r)).data}async buildHierarchyWithIri(e){var C,s;const{iri:r,ontologyId:d,showSiblingsOnInit:p,parameter:b}=e;if(!d)throw Error("ontologyId has to be specified for SKOS API.");const y=[],m=new Map,f=new Map,w=new Set,g=new Set;if(r){const t=await this.makeCall(`/${d}/hierarchy`,{params:{uri:r,lang:"en",format:"application/json",...O(b)}}).then(n=>Object.keys(n.broaderTransitive).map(l=>n.broaderTransitive[l]));for(const n of t){const l=L.fromHierarchyResult(n);f.set(l.iri,l),n.top&&y.push(l.iri),p||g.add(l.iri)}for(const n of t)if(n.narrower!=null){const l=[];for(const c of n.narrower){let i=f.get(c.uri);i==null?(i=L.fromLabelAndUriAndChildren(c,[n.uri]),f.set(i.iri,i)):(C=i==null?void 0:i.parents)!=null&&C.map(I=>I.value).includes(n.uri)||i!=null&&i.parents&&((s=i==null?void 0:i.parents)==null||s.push(...v.fromJson(n.uri))),l.push(i)}l.sort((c,i)=>(c.label||c.iri).localeCompare(i.label||i.iri)),m.set(n.uri,l.map(c=>({childIri:c.iri}))),w.add(n.uri)}}else{const t=await this.makeCall(`/${d}/topConcepts`,{params:{lang:"en",format:"application/json",...O(b)}}).then(n=>n.topconcepts);for(const n of t)y.push(n.uri)}function T(t,n){n.add(t.iri);const l=new B(t),c=m.get(t.iri)||[];if(p)for(const i of c){if(n.has(i.childIri)){console.error(`Cyclic tree at entity "${i.childIri}".`);continue}const I=f.get(i.childIri);I!=null&&l.addChild(T(I,n))}else for(const i of c){if(n.has(i.childIri)){console.error(`Cyclic tree at entity "${i.childIri}".`);continue}const I=f.get(i.childIri);I!=null&&g.has(i.childIri)&&l.addChild(T(I,n))}return l.loadedChildren.length>0&&(l.expanded=!0),n.delete(t.iri),l}const x=new Set,E=y.map(t=>T(f.get(t),x)).sort((t,n)=>(t.entityData.label||t.entityData.iri).localeCompare(n.entityData.label||n.entityData.iri));return new R({parentChildRelations:m,entitiesData:f,allChildrenPresent:w,roots:E,api:new j(this.axiosInstance.getUri()),ontologyId:d,mainEntityIri:r,keepExpansionStates:e.keepExpansionStates,parameter:b})}async loadHierarchyChildren(e){const{nodeToExpand:r,ontologyId:d,parameter:p}=e;return(await this.makeCall(`/${d}/children`,{params:{uri:r.entityData.iri,lang:"en",format:"application/json",...O(p)}})).narrower.map(y=>L.fromPrefAndUriAndChildren(y,[r.entityData.iri]))}}function $(a){return{iri:a["@id"],label:a.prefLabel,hasChildren:a.hasChildren,parents:[]}}class A{constructor(e,r){k(this,"axiosInstance");k(this,"apiKey");this.axiosInstance=W.create({baseURL:e,headers:{Accept:"application/json"}}),this.apiKey=r,this.axiosInstance.interceptors.request.use(d=>(d.params=d.params||{},d.params.apikey=this.apiKey,d.params.format="json",d))}async makeCall(e,r){return(await this.axiosInstance.get(e,r)).data}async buildHierarchyWithIri(e){const{iri:r,ontologyId:d,entityType:p,showSiblingsOnInit:b}=e;if(!d)throw Error("ontologyId has to be specified for OntoPortal API.");if(!p)throw Error("entityType has to be specified for OntoPortal API.");const y=[],m=new Map,f=new Map,w=new Set,g=new Set;function T(s){if(m.set(s["@id"],$(s)),s.hasChildren&&s.children.length>0){f.set(s["@id"],s.children.map(t=>({childIri:t["@id"]}))),w.add(s["@id"]),g.add(s["@id"]);for(const t of s.children)T(t)}}if(r){const s=await this.makeCall(`/ontologies/${d.toUpperCase()}/${D(p,!1)}/${encodeURIComponent(r)}/tree`,{params:{include:"@id,prefLabel,hasChildren,children",language:"EN"}});for(const t of s)y.push(t["@id"]),g.add(t["@id"]),T(t);g.add(r)}else{const s=await this.makeCall(`/ontologies/${d.toUpperCase()}/${D(p,!1)}/roots`,{params:{include:"@id,prefLabel,hasChildren",language:"EN"}});for(const t of s)y.push(t["@id"]),g.add(t["@id"])}function x(s,t){t.add(s.iri);const n=new B(s),l=f.get(s.iri)||[];if(b)for(const c of l){if(t.has(c.childIri)){console.error(`Cyclic tree at entity "${c.childIri}".`);continue}n.addChild(x(m.get(c.childIri),t))}else for(const c of l){if(t.has(c.childIri)){console.error(`Cyclic tree at entity "${c.childIri}".`);continue}g.has(c.childIri)&&n.addChild(x(m.get(c.childIri),t))}return n.loadedChildren.length>0&&(n.expanded=!0),t.delete(s.iri),n}const E=new Set,C=y.map(s=>x(m.get(s),E)).sort((s,t)=>(s.entityData.label||s.entityData.iri).localeCompare(t.entityData.label||t.entityData.iri));return new R({parentChildRelations:f,entitiesData:m,allChildrenPresent:w,roots:C,api:new A(this.axiosInstance.getUri(),this.apiKey),ontologyId:d,mainEntityIri:r,keepExpansionStates:e.keepExpansionStates,entityType:p})}async loadHierarchyChildren(e){const{nodeToExpand:r,ontologyId:d,entityType:p}=e;if(p==null)throw Error("entityType has to be provided to load children in an OntoPortal hierarchy.");return(await this.makeCall(`/ontologies/${d.toUpperCase()}/${D(p,!1)}/${encodeURIComponent(r.entityData.iri)}/children`,{params:{include:"@id,prefLabel,hasChildren",language:"EN"}})).collection.map(y=>$(y))}}function ee(a){let e=a.entityData.definedBy||[];return e.includes(a.ontologyId)&&(e=[]),o.jsxs("span",{style:{position:"relative",left:"16px",lineHeight:"20px"},children:[o.jsxs("span",{className:a.highlight?"highlight":void 0,children:[a.childRelationToParent=="http://purl.obolibrary.org/obo/BFO_0000050"&&o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"surroundCircle",children:" P "})," "]}),a.childRelationToParent=="http://www.w3.org/1999/02/22-rdf-syntax-ns#type"&&o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"surroundCircle",children:"I"})," "]}),o.jsx("a",{onClick:()=>{typeof a.onNavigateToEntity=="function"&&a.onNavigateToEntity(a.ontologyId,a.entityType||"",a.entityData)},style:{textAlign:"left",color:"unset",cursor:"pointer"},children:o.jsx("span",{children:a.entityData.label||a.entityData.iri})})]}),o.jsxs("span",{children:[" ",o.jsx(Q,{iri:a.entityData.iri,ontolist:e,label:a.entityData.label||"",entityType:a.entityType,onNavigateToOntology:a.onNavigateToOntology}),a.entityData.numDescendants!=null&&a.entityData.numDescendants>0&&o.jsxs("span",{style:{color:"gray"},children:[" ","(",a.entityData.numDescendants.toLocaleString(),")"]})]})]})}function te(a){const{apiUrl:e,backendType:r,apiKey:d,onNavigateToEntity:p,onNavigateToOntology:b,iri:y,ontologyId:m,entityType:f,includeObsoleteEntities:w=S.INCLUDE_OBSOLETE_ENTITIES,preferredRoots:g=S.PREFERRED_ROOTS,keepExpansionStates:T=S.KEEP_EXPANSION_STATES,showSiblingsOnInit:x=S.SHOW_SIBLINGS_ON_INIT,useLegacy:E=S.USE_LEGACY,hierarchyWrap:C=S.WRAP,className:s,parameter:t}=a,n=s||"ts4nfdi-hierarchy-style",[,l]=N.useReducer(h=>h+1%Number.MAX_SAFE_INTEGER,0),c=N.useMemo(()=>{switch(r){case"ols":return new H(e);case"skosmos":return new j(e);case"ontoportal":return new A(e,d||"");default:return new H(e)}},[e,r,d]),{data:i,isSuccess:I}=z(["hierarchySemLookP",y,f,m,g,w,T,x,E,t],async function(){return await c.buildHierarchyWithIri({ontologyId:m,iri:y,entityType:f,preferredRoots:g,includeObsoleteEntities:w,keepExpansionStates:T,showSiblingsOnInit:x,useLegacy:E,parameter:t})},{refetchOnWindowFocus:!1}),F=N.useCallback(h=>{if(!(i instanceof R))throw Error("Hierarchy object was undefined while trying to expand a tree node. This should never happen.");i.entityType&&X(i.entityType)||(h.expanded=!h.expanded,h.expanded?(h.loading=!0,l(),i.fetchInformationForExpansion(h).then(()=>{h.loading=!1,l()})):(l(),i.closeNode(h)))},[i]);function P(h,u,U){return o.jsxs("div",{children:[o.jsxs("div",{style:{position:"relative"},children:[o.jsx("div",{style:{position:"absolute"},children:u.entityData.hasChildren?o.jsxs("button",{style:{},onClick:()=>{F(u)},children:[o.jsx(_,{type:u.expanded?"arrowDown":"arrowRight",size:"s"})," "]}):o.jsx(_,{type:"empty"})}),o.jsx("div",{className:"lineNodeInlet"}),o.jsx("div",{className:U?"lineAfterNodeInlet":""}),o.jsx(ee,{entityData:u.entityData,childRelationToParent:u.childRelationToParent,ontologyId:h.ontologyId,entityType:h.entityType,onNavigateToEntity:typeof p=="function"?p:()=>{},onNavigateToOntology:typeof b=="function"?b:()=>{},highlight:u.entityData.iri==(h==null?void 0:h.mainEntityIri)})]}),u.expanded&&o.jsx("ul",{style:{marginBlockEnd:"0",marginInlineStart:"5px"},children:u.loading?o.jsx(q,{style:{position:"relative",left:"13px",top:"5px"}}):u.loadedChildren.map((K,M)=>o.jsx("div",{className:U?"outerLine":"",style:{paddingLeft:"1rem"},children:P(h,K,M<u.loadedChildren.length-1)},Y()))})]})}return o.jsx("div",{className:n,children:o.jsx(V,{"data-testid":"hierarchy",style:{overflowX:"auto",overflowY:"hidden"},children:I&&i!=null?o.jsx(Z,{style:{whiteSpace:C?"wrap":"nowrap"},children:i.roots.map((h,u)=>P(i,h,u<i.roots.length-1))}):o.jsx(q,{})})})}te.__docgenInfo={description:"",methods:[],displayName:"HierarchyWidget",props:{className:{required:!1,tsType:{name:"string"},description:"CSS class for styling"},apiUrl:{required:!0,tsType:{name:"string"},description:""},apiKey:{required:!1,tsType:{name:"string"},description:""},backendType:{required:!1,tsType:{name:"string"},description:""},hierarchyWrap:{required:!1,tsType:{name:"boolean"},description:""},entityType:{required:!1,tsType:{name:"unknown[number]",raw:"(typeof entityTypeNames)[number]"},description:""},ontologyId:{required:!1,tsType:{name:"string"},description:""},includeObsoleteEntities:{required:!1,tsType:{name:"boolean"},description:""},useLegacy:{required:!1,tsType:{name:"boolean"},description:""},parameter:{required:!1,tsType:{name:"string"},description:""},preferredRoots:{required:!1,tsType:{name:"boolean"},description:""},keepExpansionStates:{required:!1,tsType:{name:"boolean"},description:""},showSiblingsOnInit:{required:!1,tsType:{name:"boolean"},description:""},iri:{required:!1,tsType:{name:"string"},description:""},onNavigateToEntity:{required:!1,tsType:{name:"union",raw:`| ((ontologyId: string, entityType?: string, entity?: EntityData) => void)
| string`,elements:[{name:"unknown"},{name:"string"}]},description:`This function is called every time an entity link is clicked
@param ontologyId obtains the ontologyId of the current ontology
@param entityType obtains the entityType of the clicked entity
@param entity.iri obtains the iri of the clicked entity
@param entity.label obtains the label of the clicked entity
@param entity.definedBy obtains the list of ontologies the clicked entity is defined in (only OLS)
@param entity.hasChildren obtains a boolean indicating whether the clicked entity has child entities
@param entity.numDescendants obtains the number of hierarchical descendants of the clicked entity (only OLS)
@param entity.parents obtains the list of parent entities of the clicked entity (only OLS, Skosmos)`},onNavigateToOntology:{required:!1,tsType:{name:"union",raw:`| ((ontologyId: string, entityType?: string, entity?: EntityData) => void)
| string`,elements:[{name:"unknown"},{name:"string"}]},description:`This function is called every time an entity link is clicked
@param ontologyId obtains the ontologyId of the clicked badge
@param entityType obtains the entityType of the clicked badge
@param entity.iri obtains the iri of the clicked badge (can be empty)
@param entity.label obtains the label of the clicked badge
@param entity.definedBy obtains the list of ontologies the clicked entity is defined in (only OLS)
@param entity.hasChildren obtains a boolean indicating whether the clicked entity has child entities
@param entity.numDescendants obtains the number of hierarchical descendants of the clicked entity (only OLS)
@param entity.parents obtains the list of parent entities of the clicked entity (only OLS, Skosmos)`}}};export{te as H};
